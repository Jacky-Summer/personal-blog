# æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ Gatsby

## Gatsby ä»‹ç»

### ä»€ä¹ˆæ˜¯ Gatsby

Gatsby æ˜¯ä¸€ä¸ªåŸºäº React ï¼Œç”¨äºæ­å»ºé™æ€ç«™ç‚¹çš„å¼€æºæ¡†æ¶ï¼Œç”¨äºå¸®åŠ© å¼€å‘è€…æ„å»ºè¿è¡Œé€Ÿåº¦æå¿«çš„ç½‘ç«™ã€‚å¯ä»¥è¯´å®ƒæ˜¯ä¸€ä¸ªé™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼ŒGatsby ä¸»è¦çš„åº”ç”¨çš„æŠ€æœ¯æ˜¯ React å’Œ GraphQLã€‚

å®˜ç½‘ï¼šhttps://www.gatsbyjs.org/

### ä¸ºä»€ä¹ˆé€‰ Gatsby

Gatsby èƒ½å¿«é€Ÿä½¿ç”¨ React ç”Ÿæ€ç³»ç»Ÿæ¥ç”Ÿæˆé™æ€ç½‘ç«™ï¼Œå®ƒå…·å¤‡æ›´é«˜çš„æ€§èƒ½ï¼Œè€Œä¸” Gatsby çš„ç”Ÿæ€ä¹Ÿå¾ˆå¼ºå¤§ã€‚

å½“ä½ æƒ³è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸ªäººåšå®¢æ—¶ï¼Œè€ƒè™‘çš„æ˜¯ SEO è¦å¥½ï¼Œè€Œä¸”ä½ ä¸ç”¨ç†ä¼šæ•°æ®åº“å’ŒæœåŠ¡å™¨ç­‰å¤æ‚çš„éƒ¨ç½²è®¾ç½®ï¼ŒGatsby æ„å»ºçš„ç½‘ç«™ä¸ºé™æ€ç«™ç‚¹ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾çš„å°†ç½‘ç«™éƒ¨ç½²åœ¨å¾ˆå¤šæœåŠ¡ä¸Šã€‚Gatsby ä¸éœ€è¦ç­‰å¾…è¯·æ±‚æ—¶ç”Ÿæˆé¡µé¢ï¼Œè€Œæ˜¯é¢„å…ˆç”Ÿæˆé¡µé¢ï¼Œå› æ­¤ç½‘ç«™çš„é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚

Gatsby ä¸­è¿ç”¨äº† React, react-router, Webpack ä»¥åŠ GraphQL ç­‰æ–°æŠ€æœ¯ï¼Œä¹Ÿè·Ÿéšäº†æŠ€æœ¯æ½®æµã€‚

## GraphQL ä»‹ç»

ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº† GraphQLï¼Œæ²¡äº†è§£çš„åŒå­¦å¯èƒ½ä¸å¤ªæ¸…æ¥šã€‚

> GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ Restful API çš„æ›¿ä»£å“ã€‚

è‡³äºæ›¿ä»£ Restful API ä¸€è¯´ï¼Œä¸ªäººè§‰å¾—ç°åœ¨ Restful API å æ®ç»å¯¹çš„ä¸»å¯¼åœ°ä½ï¼Œå½“å‰è¿˜æ˜¯å¾ˆéš¾è¢«æ’¼åŠ¨çš„ã€‚å› ä¸ºç›®å‰æ¥çœ‹ï¼ŒGraphQL ä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ã€‚

çœ‹åˆ°è¿™é‡Œæ²¡å­¦è¿‡ GraphQL ä¹Ÿä¸ç”¨æ€•ï¼Œå› ä¸ºç”¨åˆ°çš„ä¸å¤šè€Œä¸” Gatsby å†…ç½®ä¸€ä¸ªç•Œé¢æ–¹ä¾¿æˆ‘ä»¬æ“ä½œã€‚GraphQL ç›®å‰å›½å¤–æ¯”è¾ƒç«ï¼Œå®ƒä½œä¸ºä¸€é—¨æ–°æŠ€æœ¯ï¼Œå³ä½¿ä¸æ·±å…¥æˆ‘ä»¬ä¹Ÿå¯ä»¥äº†è§£ä¸€ä¸‹ã€‚

è¿™é‡Œæˆ‘ä»¬å½“ç„¶è¦å¹æ§å®ƒçš„ä¼˜ç‚¹ï¼Œä¸Šé¢çš„å®šä¹‰ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼ŒAPI ä¸å°±æ˜¯åç«¯å†™å¥½çš„æ¥å£å—ï¼Œæ€ä¹ˆè¿˜èƒ½æŸ¥è¯¢ï¼Ÿ

GraphQL æˆ‘ä»¬æŠŠè¿™ä¸ªå•è¯æ‹†å¼€çš„è¯æ˜¯ï¼š Graph(å›¾å½¢æˆ–å›¾è¡¨) + QLï¼ˆQuery Languageï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§å›¾å½¢åŒ–çš„æŸ¥è¯¢è¯­è¨€ï¼Œæè¿°å®¢æˆ·ç«¯å¦‚ä½•åƒæœåŠ¡ç«¯è¯·æ±‚æ•°æ®çš„è¯­æ³•è§„èŒƒã€‚å¬èµ·æ¥æ¨¡æ¨¡ç³Šç³Šï¼Œé‚£å®ƒç›¸å¯¹ Restful API åˆè§£å†³äº†ä»€ä¹ˆç—›ç‚¹å‘¢ï¼Ÿ

1. è¯·æ±‚ä½ æ‰€è¦çš„æ•°æ®ä¸å¤šä¸å°‘

ç›¸ä¿¡å¤šæ•°äººè‚¯å®šé‡åˆ°è¿‡çš„åœºæ™¯ï¼Œæ¯”å¦‚é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œè¿›å…¥æŸé¡µé¢å±•ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸Šåªéœ€å±•ç¤ºæ ‡é¢˜ï¼Œä½†ä½ è¯·æ±‚è¿”å›çš„æ•°æ®å´å¤šäº†å…¶ä»–ä¿¡æ¯ï¼Œæ¯”å¦‚åˆ›å»ºè€…ã€åˆ›å»ºæ—¶é—´ç­‰ã€‚è¿™äº›ä¿¡æ¯åœ¨è¿™é‡Œæ˜¯å¤šä½™çš„ï¼Œä½†å®ƒå¯èƒ½æœ‰å®ƒè‡ªå·±å­˜åœ¨çš„ç†ç”±ï¼Œæˆ–è®¸æ˜¯å…¶ä»–åœºæ™¯éœ€è¦è¿”å›è¿™äº›ä¿¡æ¯ï¼Œå› æ­¤è¯¥æ¥å£å°±ç›´æ¥åŒ…å«äº†æ‰€æœ‰æ•°æ®ã€‚

è¿™ä¸€ç‚¹ï¼ŒGraphQL èƒ½å‡†ç¡®è·å–ä½ æƒ³è¦çš„æ•°æ®ï¼Œä¸å¤šä¸å°‘ï¼Œæƒ³è¦è¿”å›æŒ‡å®šçš„ä»€ä¹ˆæ•°æ®ï¼Œå°±è¿”å›ä»€ä¹ˆæ•°æ®ã€‚æ•°æ®ç”±åº”ç”¨æ¥æ§åˆ¶ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨ã€‚

2. è·å–å¤šä¸ªèµ„æºåªéœ€è¦ä¸€ä¸ªè¯·æ±‚

GraphQL æŸ¥è¯¢ä¸ä»…èƒ½å¤Ÿè·å¾—èµ„æºçš„å±æ€§ï¼Œè¿˜èƒ½æ²¿ç€èµ„æºé—´å¼•ç”¨è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚å…¸å‹çš„ REST API è¯·æ±‚å¤šä¸ªèµ„æºæ—¶å¾—è½½å…¥å¤šä¸ª URLï¼Œè€Œ GraphQL å¯ä»¥é€šè¿‡ä¸€æ¬¡è¯·æ±‚å°±è·å–ä½ åº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ˜¯æ¯”è¾ƒæ…¢çš„ç§»åŠ¨ç½‘ç»œè¿æ¥ä¸‹ï¼Œä½¿ç”¨ GraphQL çš„åº”ç”¨ä¹Ÿèƒ½è¡¨ç°å¾—è¶³å¤Ÿè¿…é€Ÿã€‚

3. æè¿°æ‰€æœ‰çš„å¯èƒ½ç±»å‹ç³»ç»Ÿ

GraphQL API åŸºäºç±»å‹å’Œå­—æ®µçš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼Œè€Œéå…¥å£ç«¯ç‚¹ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªå•ä¸€å…¥å£ç«¯ç‚¹å¾—åˆ°ä½ æ‰€æœ‰çš„æ•°æ®èƒ½åŠ›ã€‚GraphQL ä½¿ç”¨ç±»å‹æ¥ä¿è¯åº”ç”¨åªè¯·æ±‚å¯èƒ½çš„æ•°æ®ï¼Œè¿˜æä¾›äº†æ¸…æ™°çš„è¾…åŠ©æ€§é”™è¯¯ä¿¡æ¯ã€‚åº”ç”¨å¯ä»¥ä½¿ç”¨ç±»å‹ï¼Œè€Œé¿å…ç¼–å†™æ‰‹åŠ¨è§£æä»£ç ã€‚

Gatsby ä½¿ç”¨äº† GraphQLï¼Œä½œä¸ºåœ¨æœ¬åœ°ç®¡ç†èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚

## æ­å»ºé¡¹ç›®

### å¼€å§‹

- å®‰è£… Gatsby è„šæ‰‹æ¶

```
npm install -g gatsby-cli
```

- æ–°å»ºé¡¹ç›®

> gatsby new [projectName][starter]ï¼šæ ¹æ® starter åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®

```
gatsby new gatsby-blog-demo https://github.com/gatsbyjs/gatsby-starter-hello-world
```

æˆ‘ä»¬è¿™é‡Œä½¿ç”¨å®˜æ–¹æœ€ç®€å•ç‰ˆæœ¬çš„ hello-world æ¨¡æ¿è¿›è¡Œå¼€å‘ï¼Œå¦‚æœä½ ç›´æ¥ä½¿ç”¨

```
gatsby new gatsby-blog-demo
```

é»˜è®¤ä¼šä½¿ç”¨ [gatsby-starter-default](https://github.com/gatsbyjs/gatsby-starter-default) æ¥æ–°å»ºé¡¹ç›®

- è¿è¡Œé¡¹ç›®

```
cd gatsby-blog-demo
gatsby develop
```

æ‰“å¼€ `localhost:8000`ï¼Œå°±å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†ä¸€å¥`Hello world!`

### å¸¸ç”¨å‘½ä»¤

è¿™é‡Œä»‹ç» Gatsby çš„å‡ ä¸ªå¸¸ç”¨å‘½ä»¤ï¼š

- gastby developï¼šå¼€å¯çƒ­åŠ è½½å¼€å‘ç¯å¢ƒ
- gastby buildï¼šæ‰“åŒ…åˆ° public ä¸‹ï¼Œæ„å»ºç”Ÿäº§ç¯å¢ƒç”¨çš„ä¼˜åŒ–è¿‡çš„é™æ€ç½‘ç«™æ‰€éœ€çš„ä¸€åˆ‡é™æ€èµ„æºã€é™æ€é¡µé¢ä¸ js ä»£ç 
- gatsby serveï¼šåœ¨æ‰“åŒ…ä¹‹åï¼Œå¯åŠ¨ä¸€ä¸ªæœ¬åœ°çš„æœåŠ¡ï¼Œä¾›ä½ æµ‹è¯•åˆšæ‰"gatsby build"ç”Ÿæˆçš„é™æ€ç½‘é¡µ

### GraphiQL

æ‰“å¼€`http://localhost:8000/__graphql`ï¼Œå°±ä¼šçœ‹åˆ° GraphQL çš„è°ƒè¯•ç•Œé¢ï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®ã€ä»¥åŠè°ƒè¯• query è¯­å¥æ˜¯å¦è¿”å›ç›¸åº”çš„æ•°æ®ã€‚å¯ä»¥ç›´æ¥åœ¨å·¦ä¾§ç‚¹å‡»é€‰ä¸­ï¼Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ query è¯­å¥ã€‚

![](https://user-gold-cdn.xitu.io/2020/6/21/172d4b8f913506df?w=1922&h=538&f=png&s=78717)

### å¯èƒ½å‡ºç°çš„è­¦å‘Š

å¦‚æœè¿è¡Œåä½ çš„æ§åˆ¶å°å‡ºç°ï¼š

```
React-Hot-Loader: react-ğŸ”¥-dom patch is not detected. React 16.6+ features may not work.
```

å¯ä»¥è¿™æ ·è§£å†³:

```
npm install @hot-loader/react-dom
```

åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º`gatsby-node.js`

```
exports.onCreateWebpackConfig = ({ getConfig, stage }) => {
  const config = getConfig()
  if (stage.startsWith('develop') && config.resolve) {
    config.resolve.alias = {
      ...config.resolve.alias,
      'react-dom': '@hot-loader/react-dom'
    }
  }
}
```

å†é‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œå°±å¯ä»¥æ¶ˆé™¤è¿™ä¸ªè­¦å‘Š

### é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ .cache
â”œâ”€â”€ public
â”œâ”€â”€ src
|  â””â”€â”€ pages            // è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ä¼šè¢«æ˜ å°„ä¸ºè·¯ç”±
|     â””â”€â”€ index.js
â”œâ”€â”€ static              // é™æ€èµ„æº
â”œâ”€â”€ .prettierignore
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ gatsby-config.js    // åŸºæœ¬é…ç½®æ–‡ä»¶
â”œâ”€â”€ LICENSE
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ yarn.lock
```

## Gatsby é…ç½®æ–‡ä»¶

è¿™é‡Œæœ€åˆå§‹çš„æ¨¡æ¿åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬é¡¹ç›®ä¸­éƒ½ä¼šæœ‰ 4 ä¸ªé…ç½®æ–‡ä»¶

### gatsby-config.js

åŸºæœ¬é…ç½®æ–‡ä»¶ã€‚æ•´ä¸ª Gatsby ç«™ç‚¹çš„é…ç½®æ–‡ä»¶ã€‚å¯ä»¥åœ¨é‡Œé¢é…ç½®ç½‘ç«™çš„ç›¸å…³åŸºæœ¬ä¿¡æ¯ã€‚

### gatsby-node.js

node ç›¸å…³é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åªä¼šåœ¨ build æœŸé—´è¿è¡Œä¸€æ¬¡ï¼Œæ¯”å¦‚åŠ¨æ€åˆ›å»ºä¸€äº›é¡µé¢ã€‚

### gatsby-browser.js

å®¢æˆ·ç«¯ç›¸å…³é…ç½®ã€‚ä¸€äº›æµè§ˆå™¨ç›¸å…³çš„ API é€šè¿‡åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå»å®ç°ï¼Œæ¯”å¦‚ä¸€äº›ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œæ³¨å†Œ serviceWorker ç­‰ç­‰ã€‚

### gatsby-ssr.js

æœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ Gatsby çš„æœåŠ¡ç«¯æ¸²æŸ“ API è‡ªå®šä¹‰å½±å“æœåŠ¡ç«¯æ¸²æŸ“çš„é»˜è®¤è®¾ç½®ã€‚

## åˆ›å»ºé¡µé¢

### è·¯ç”±é¡µ

æˆ‘ä»¬åœ¨ `pages`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶`about.js`ï¼Œåˆ™å¯¹åº”çš„è·¯ç”±è·¯å¾„ä¸º`/about`

```javascript
import React from 'react'

const About = () => {
  return <div>about me</div>
}

export default About
```

æ‰“å¼€`http://localhost:8000/about`ï¼Œæ˜¾ç¤ºçš„æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„é¡µé¢

### 404 é¡µé¢

`pages`ç›®å½•ä¸‹çš„æ–‡ä»¶åå³æ˜¯è·¯ç”±è·¯å¾„ï¼Œä½†æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œå½“åŒ¹é…ä¸åˆ°è·¯å¾„æ—¶ï¼ŒGatsby ä¼šè·³è½¬åˆ° 404 é¡µé¢ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ pages ä¸‹åˆ›å»ºæ–‡ä»¶å`404.js`ï¼Œä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢ã€‚å½“å‰æˆ‘ä»¬éšä¾¿è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢è·¯å¾„ï¼š`http://localhost:8000/test`ï¼Œé¡µé¢å°±ä¼šæŠ¥é”™ã€‚

æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ 404.js

```javascript
import React from 'react'

const About = () => {
  return <div>404 é¡µé¢ä¸å­˜åœ¨</div>
}

export default About
```

å†éšä¾¿è¾“å…¥ä¸€ä¸ªè·¯å¾„ï¼Œæ˜¾ç¤ºå‡ºè¯¥é¡µé¢ï¼š
![](https://user-gold-cdn.xitu.io/2020/6/21/172d52ba499ad501?w=1223&h=404&f=png&s=37041)

Gatsby ä¼šç¡®ä¿å°† 404 é¡µé¢æ„å»ºä¸º 404.htmlï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºæ­¤é¡µé¢ï¼Œåœ¨è¯¥é¡µé¢ä¹Ÿåˆ—å‡ºäº†ç½‘ç«™ä¸Šçš„æ‰€æœ‰é¡µé¢è·¯ç”±é“¾æ¥,æˆ‘ä»¬å¯ä»¥é€šè¿‡å•å‡»`Preview custom 404 page`çœ‹æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ 404 é¡µé¢ã€‚

é‚£æˆ‘ä»¬æƒ³ç›´æ¥è·³è½¬åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢å•Šï¼Œè¿˜è¦æˆ‘ä»¬ç‚¹å‡»æ‰è·³è½¬ã€‚åŸå› æ˜¯å¤„äºå¼€å‘ç¯å¢ƒï¼Œå³å½“ä½¿ç”¨ `gatsby develop`æ—¶ï¼ŒGatsby ä½¿ç”¨é»˜è®¤çš„ 404 é¡µé¢è¦†ç›–æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢ï¼Œä½†å®é™…ä¸Šæ˜¯å·²ç»ç”Ÿæ•ˆäº†ã€‚

æˆ‘ä»¬å¯ä»¥æ‰“åŒ…ï¼Œå¯åŠ¨ä¸€ä¸ªæœ¬åœ°çš„æœåŠ¡ï¼Œæ¨¡æ‹Ÿå¤„äºçº¿ä¸Šç¯å¢ƒæ¥çœ‹ï¼Œè¿™ä¸ªæ—¶å€™æ‰æ˜¯ç›´æ¥æ˜¾ç¤ºæˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢ã€‚

```
gatsby build
gatsby serve
```

ç„¶åæ‰“å¼€`http://localhost:9000/test`ï¼ˆä»»æ„è·¯å¾„ï¼‰ï¼Œå°±èƒ½è·³è½¬åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ 404 é¡µé¢äº†

![](https://user-gold-cdn.xitu.io/2020/6/21/172d5e52ae8fcd52?w=334&h=102&f=png&s=3896)

### åˆ›å»ºå¸ƒå±€ç»„ä»¶

1. åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• `src/components`ã€‚

2. åœ¨ä¸Šé¢çš„ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªå¸ƒå±€ç»„ä»¶æ–‡ä»¶ src/components/layout.jsï¼š

```javascript
import React from 'react'

export default ({ children }) => (
  <div style={{ margin: `3rem auto`, maxWidth: 650, padding: `0 1rem` }}>{children}</div>
)
```

3. åœ¨`src/pages/index.js`ä¸­ï¼ŒåŠ å…¥ Layout ç»„ä»¶ï¼Œ

```javascript
import React from 'react'
import Layout from '../components/layout'

export default function Home() {
  return <Layout>Hello world!</Layout>
}
```

è¿™æ ·å°±è®©æ•´ä½“é¡µé¢å±…ä¸­äº†ï¼Œè¿™é‡Œéƒ½æ˜¯ React çš„åŸºæœ¬æ“ä½œ

## è®¾ç½® CSS æ ·å¼

Gatsby ä¸­æ ·å¼å¯ä»¥ä½¿ç”¨å¤šç§å½¢å¼ï¼Œæ™®é€šçš„ `import './xxx.css`æˆ‘ä»¬å°±ä¸è¯´äº†ã€‚

### ä½¿ç”¨å…¨å±€æ ·å¼

æˆ‘ä»¬å‘ç½‘ç«™æ·»åŠ å…¨å±€æ ·å¼çš„æœ€ç›´æ¥çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨å…¨å±€ .css æ ·å¼è¡¨ã€‚

åœ¨ src ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹`styles`ï¼Œæ·»åŠ ä¸€ä¸ª global.css æ–‡ä»¶

```
html {
  background-color: #f5f5f5;
}
```

- åœ¨ç›®å½•ä¸‹åˆ›å»º gatsby-browser.js ä¸­ï¼Œå°†æ ·å¼æ–‡ä»¶å¯¼å…¥

```
import "./src/styles/global.css"
```

é‡å¯æœ¬åœ°æœåŠ¡ï¼Œå°±å‘ç°é¡µé¢èƒŒæ™¯å˜ä¸ºæµ…ç°è‰²äº†ã€‚

### ä½¿ç”¨ CSS Module ä¸ºç»„ä»¶è®¾ç½®æ ·å¼

CSS Module å¯ä»¥å‡å°‘å…¨å±€æ±¡æŸ“ã€é˜²æ­¢å‘½åå†²çªå’Œæ ·å¼çš„è¦†ç›–ã€‚

> CSS Module å®ç°åŸç†æ˜¯ï¼šå°†æ‰€æœ‰æ¨¡å—åŒ–çš„ç±»åï¼Œä¿®æ”¹ä¸ºæˆå”¯ä¸€çš„åç§°ï¼Œå³æ·»åŠ ä¸€äº›ä¸é‡å¤çš„å‰ç¼€æˆ–åç¼€ã€‚è¿™æ ·ä½¿å¾—é¡¹ç›®ä¸­ï¼Œä¸åŒäººå‘˜ç¼–å†™çš„æ ·å¼ä¸ä¼šå‡ºç°è¦†ç›–å’Œå†²çªã€‚

1. åˆ›å»º CSS æ–‡ä»¶ `src/styles/index.module.css`

```
.title {
  color: red;
}
.text {
  color: blue;
}
```

ç”¨æ³•å¦‚ä¸‹ï¼š`src/pages/index.js`

```
import React from "react"
import Layout from "../components/layout"
import styles from "../styles/index.module.css"

export default function Home() {
  console.log(styles)
  return (
    <Layout>
      <h1 className={styles.title}>Hello World</h1>
      <div className={styles.text}>Test</div>
    </Layout>
  )
}
```

è¿è¡Œç»“æœï¼š

![](https://user-gold-cdn.xitu.io/2020/6/21/172d61d3f95cadf0?w=718&h=174&f=png&s=5935)

è¾“å‡º `styles`,å¯ä»¥çœ‹åˆ°è¢«å¯¼å…¥å¤„ç†çš„ç»“æœ:

![](https://user-gold-cdn.xitu.io/2020/6/21/172d61cc37846a59?w=514&h=68&f=png&s=6441)
å¦‚æœå°†å…¶ä¸ CSS æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œä½ ä¼šå‘ç°æ¯ä¸ªæ ¼å¼ç°åœ¨éƒ½æ˜¯å¯¼å…¥å¯¹è±¡ä¸­æŒ‡å‘é•¿å­—ç¬¦ä¸²çš„é”®ï¼ˆkeyï¼‰ï¼Œä¾‹å¦‚ `title` æŒ‡å‘ `index-module--title--1i-Wh`ã€‚ è¿™äº›æ ·å¼åç§°æ˜¯ CSS æ¨¡å—ç”Ÿæˆçš„ã€‚ ä¿è¯å®ƒä»¬åœ¨ä½ çš„ç½‘ç«™ä¸Šæ˜¯å”¯ä¸€çš„ã€‚ è€Œä¸”ç”±äºå¿…é¡»å¯¼å…¥å®ƒä»¬æ‰èƒ½ä½¿ç”¨è¿™äº›ç±»ï¼Œæ‰€ä»¥å¯¹äºåœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº› CSS æ ·å¼éƒ½æ²¡é—®é¢˜ã€‚

### å…¶ä»–å¤„ç† CSS çš„æ–¹å¼

ä½¿ç”¨ css æ ·å¼å°±ç‚¹åˆ°ä¸ºæ­¢äº†ï¼Œå…¶ä»–çš„æ¯”å¦‚ Sass ç­‰ï¼›è¿˜æœ‰ CSS in JS çš„æ–¹å¼ï¼Œæ¯”å¦‚ Emotion, Styled Componentã€‚å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹ç›¸åº”æ”¯æŒçš„ Gatsby æ’ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚

## è·å– Gatsby ä¸­çš„æ•°æ®

å»ºç«‹ç½‘ç«™æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦é‡ç”¨ä¸€äº›å¸¸ç”¨çš„æ•°æ®â€”â€”æ¯”å¦‚å…¬ç”¨çš„ç½‘ç«™æ ‡é¢˜ã€ä½œè€…ä¿¡æ¯ç­‰ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åœ¨æ¯ä¸ªé¡µé¢éƒ½åŠ ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæ ‡é¢˜å­˜å‚¨åœ¨ä¸€ä¸ªä½ç½®ï¼Œç„¶åä»å…¶ä»–æ–‡ä»¶å¼•ç”¨è¯¥ä½ç½®å°±è¡Œäº†ï¼Œæ›´æ”¹çš„æ—¶å€™ä¹Ÿåªèƒ½æ›´æ”¹è¿™ä¸€å¤„åœ°æ–¹ã€‚

è¿™äº›å¸¸ç”¨æ•°æ®çš„å­˜æ”¾ä½ç½®å°±æ˜¯ `gatsby-config.js` æ–‡ä»¶ä¸­çš„ `siteMetadata` å¯¹è±¡ã€‚æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå†™å…¥ä»£ç ï¼š

```
module.exports = {
  /* Your site config here */
  siteMetadata: {
    title: `Title from siteMetadata`,
    author: 'jacky'
  },
  plugins: [],
}
```

é‡å¯æœåŠ¡

### ä½¿ç”¨é¡µé¢æŸ¥è¯¢

ç¼–è¾‘ `src/pages/about.js`

```javascript
import React from 'react'
import { graphql } from 'gatsby'

// GraphQL è·å–çš„æ•°æ®ï¼Œä¼šå½“åšå‚æ•°ä¼ é€’åˆ°é¡µé¢ç»„ä»¶ä¸­
// æ•°æ®çš„å½¢å¼æ˜¯ { errors, data }ï¼Œæ²¡æœ‰é”™è¯¯åˆ™ä¸ä¼šæœ‰ errors
const About = ({ data }) => {
  console.log(data.site.siteMetadata.title)
  return (
    <div>
      <h1>Title: {data.site.siteMetadata.title}</h1>
      <p>author: {data.site.siteMetadata.author}</p>
      <div>about me</div>
    </div>
  )
}

export default About

export const query = graphql`
  query {
    site {
      siteMetadata {
        title
        author
      }
    }
  }
`
```

ç„¶åå°±æ‹‰å‡ºæ•°æ®äº†

![](https://user-gold-cdn.xitu.io/2020/6/21/172d63bec7bccdeb?w=576&h=188&f=png&s=10256)

å…¶ä¸­ï¼ŒGraphQL æŸ¥è¯¢è¯­å¥æ˜¯ï¼š

```
{
  site {
    siteMetadata {
      title,
      author
    }
  }
}
```

ä½ å¯èƒ½ä¼šæ‡µé€¼ï¼Œ site æ˜¯å“ªé‡Œæ¥çš„ï¼Œè¿™æ•°æ®æ ¼å¼æ€ä¹ˆæ˜¯è¿™æ ·ï¼Œè¿™å°±æ˜¯ GraphQL æŸ¥è¯¢è¯­å¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ Gatsby å†…ç½®çš„ GraphQL è°ƒè¯•ç•Œé¢ `http://localhost:8000/__graphql`ã€‚

è¿™é‡Œçš„`site`å³ä¸ºæˆ‘ä»¬`gatsby-config.js`å†™çš„ç«™ç‚¹é…ç½®ã€‚

ä¾æ¬¡ç‚¹å‡»å·¦è¾¹çš„`site`ã€`siteMetadata`ï¼Œç„¶åæœ‰æˆ‘ä»¬åˆšæ‰å†™çš„`title`,`author`å­—æ®µ ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œåœ¨ç‚¹å‡»çš„åŒæ—¶ï¼Œä¸­é—´çš„æ¡†ä¼šç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œæœ€åç‚¹å‡»è¿è¡ŒæŒ‰é’®ï¼Œä¼šè¾“å‡ºæŸ¥è¯¢ç»“æœã€‚

![](https://user-gold-cdn.xitu.io/2020/6/21/172d660d32ae1825?w=1442&h=642&f=png&s=61514)

å½“ä½ åé¢éœ€è¦è·å–æ›´å¤šå¤æ‚åµŒå¥—æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªç•Œé¢æ‰¾å’Œç‚¹å‡»ï¼Œè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢è¯­å¥å°±è¡Œäº†ã€‚

ç”±æˆ‘ä»¬è‡ªå·±å†™çš„æŸ¥è¯¢è¯­å¥ä¹ŸçŸ¥é“ï¼Œä¸Šé¢æˆ‘ä»¬ä»‹ç» GraphQL çš„æ—¶å€™è¯´çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œè·å–æ•°æ®ä¸å¤šä¸å°‘ï¼Œå³æˆ‘ä»¬å¯ä»¥é€‰æ‹©æƒ³è¦çš„æ•°æ®ï¼Œæ¯”å¦‚æˆ‘å°±æƒ³è·å–æ ‡é¢˜ä¸æƒ³è·å–ä½œè€…

```
export const query = graphql`
  query {
    site {
      siteMetadata {
        title
      }
    }
  }
`
```

### ä½¿ç”¨éé¡µé¢ç»„ä»¶æŸ¥è¯¢ï¼ˆé™æ€æŸ¥è¯¢ï¼‰

è¿™é‡Œæ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†ä¸¤ç§æ–¹å¼çš„æŸ¥è¯¢ï¼Œä¸Šé¢çš„ä¾‹å­çš„æŸ¥è¯¢æ–¹å¼ï¼Œåªé€‚ç”¨äºé¡µé¢æŸ¥è¯¢ï¼Œå³æ˜¯åœ¨`src/pages`ä¸‹çš„è·¯ç”±ç•Œé¢ï¼Œå¦‚æœåœ¨éé¡µé¢ç»„ä»¶ä¸‹è¿›è¡Œ GraphQL æŸ¥è¯¢ï¼Œåˆ™ä¸èƒ½ç”¨ä¸Šé¢çš„æ–¹å¼ï¼Œåº”è¯¥ä½¿ç”¨ `StaticQuery` ç»„ä»¶æˆ–è€… `useStaticQuery hook`ã€‚

```
// é¡µé¢æŸ¥è¯¢
export const query = graphql`
    query{ ... }
`
```

æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»„ä»¶`src/components/header.js`

- StaticQuery

```javascript
import React from 'react'
import { graphql, StaticQuery } from 'gatsby'

const Header = () => (
  <StaticQuery
    query={graphql`
      query {
        site {
          siteMetadata {
            author
          }
        }
      }
    `}
    render={data => {
      const {
        site: { siteMetadata },
      } = data
      return <div>è¿™æ˜¯Headerç»„ä»¶ï¼Œä½œè€…æ˜¯ï¼š{siteMetadata.author}</div>
    }}
  />
)

export default Header
```

æˆ–è€…ä½¿ç”¨ useStaticQuery æ–¹å¼

- useStaticQuery

```
import React from "react"
import { useStaticQuery, graphql } from "gatsby"

const Header = () => {
  const data = useStaticQuery(
    graphql`
      query {
        site {
          siteMetadata {
            author
          }
        }
      }
    `
  )
  return <div>è¿™æ˜¯Headerç»„ä»¶ï¼Œä½œè€…æ˜¯ï¼š{data.site.siteMetadata.author}</div>
}

export default Header
```

ç„¶ååœ¨`src/pages/index.js`ä¸­å¼•å…¥ Header ç»„ä»¶

```javascript
import React from 'react'
import Layout from '../components/layout'
import Header from '../components/header'
import styles from '../styles/index.module.css'

export default function Home() {
  return (
    <Layout>
      <Header />
      <h1 className={styles.title}>Hello World</h1>
      <div className={styles.text}>Test</div>
    </Layout>
  )
}
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

![](https://user-gold-cdn.xitu.io/2020/6/21/172d6d9b2afff80c?w=705&h=203&f=png&s=8464)

## æ’ä»¶

### gatsby-source-filesystem

è¿™ä¸ªæ˜¯ Gatsby çš„æ•°æ®æºæ’ä»¶ï¼Œå³é€šè¿‡è¯¥æ’ä»¶å°†å„æ–¹é¢çš„æ•°æ®è½¬æ¢ä¸ºæœ¬åœ°èƒ½å¤Ÿé€šè¿‡ GraphQL æå–çš„å†…å®¹ï¼Œç”¨äºè®¾ç½®é¡¹ç›®çš„æ–‡ä»¶ç³»ç»Ÿã€‚

- å®‰è£…æ’ä»¶

```
npm install --save gatsby-source-filesystem
```

- åœ¨ gatsby-config.js æ–‡ä»¶é…ç½®

```javascript
module.exports = {
  siteMetadata: {
    title: `Title from siteMetadata`,
    author: 'jacky',
  },
  plugins: [
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `src`, // åç§°ï¼Œå¯ä»¥ç”¨æ¥è¿‡æ»¤
        path: `${__dirname}/src/`, // æ–‡ä»¶è·¯å¾„
      },
    },
  ],
}
```

é‡å¯æœåŠ¡

æ‰“å¼€`http://localhost:8000/__graphql`ï¼Œå…³æ³¨`allFile`å’Œ`file`ä¸¤ä¸ªå¯é€‰é¡¹ã€‚

æˆ‘ä»¬ç‚¹å‡» `allFile`è¿™ä¸ªå¯é€‰é¡¹ï¼Œä¾æ¬¡é€‰æ‹©å¦‚ä¸‹å›¾

![](https://user-gold-cdn.xitu.io/2020/6/21/172d74ca7b60229d?w=1542&h=928&f=png&s=113095)

è¿™é‡Œæˆ‘ä»¬è¦çŸ¥é“ï¼Œæˆ‘ä»¬è¦æŸ¥è¯¢çš„æ•°æ®åŸºæœ¬åœ¨`edges.node`ä¸‹ï¼ŒèŠ‚ç‚¹ `node`æ˜¯å›¾ï¼ˆgraphï¼‰ä¸­ä¸€ä¸ªå¯¹è±¡çš„ç‰¹æ®Šç§°å‘¼ï¼Œæ¯ä¸ª File èŠ‚ç‚¹éƒ½åŒ…å«äº†ä½ è¦æŸ¥è¯¢çš„å­—æ®µã€‚

æˆ‘ä»¬é€‰æ‹©çš„`id`,`relativePath`,`name`å­—æ®µéƒ½å¯¹åº”æˆ‘ä»¬ `src`ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶, è¿˜æœ‰å¾ˆå¤šå…¶ä»–å­—æ®µå¯é€‰æ‹©ï¼Œç”±æ­¤å¯çŸ¥æˆ‘ä»¬åˆ›å»ºçš„ 7 ä¸ªæ–‡ä»¶çš„å„ç§ä¿¡æ¯ã€‚

æ—¢ç„¶è¿™é‡Œèƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œè¯´æ˜æˆ‘ä»¬ç»„ä»¶é‡Œé¢ä¹Ÿèƒ½æŸ¥å‡ºæ¥ç„¶åä½¿ç”¨æ•°æ®ï¼Œæ¯”å¦‚ä½ å¯ä»¥ä»ç»„ä»¶ä¸­æŸ¥è¯¢å‡ºæ¥åšä¸ªæ–‡ä»¶åˆ—è¡¨ã€‚

è¿™ä¸ªç›¸æ¯”ä¼ ç»Ÿçš„ React é¡¹ç›®å°±æŒºå‰å®³äº†ï¼Œä¸ç”¨åšä»€ä¹ˆå¤æ‚çš„å·¥ä½œï¼Œå°±èƒ½è½»æ¾æ‹¿ä¸‹è¿™äº›æ•°æ®ã€‚Gatsby æ¯”è¾ƒå¼ºå¤§çš„å°±æ˜¯å®ƒçš„ç”Ÿæ€äº†ï¼Œå¾ˆå¤šæ’ä»¶éƒ½é…å¥½äº†ï¼Œæ›´å¤šæ’ä»¶å¯ä»¥çœ‹å®˜ç½‘çš„æ’ä»¶åº“ä»‹ç»ï¼šhttps://www.gatsbyjs.org/plugins/

### gatsby-transformer-remark

è¿™ä¸ªæ˜¯æ•°æ®è½¬æ¢æ’ä»¶ï¼Œæˆ‘ä»¬ç”¨ Gatsby åšä¸ªäººåšå®¢çš„è¯ï¼Œå®ƒå¯å¿…ä¸å¯å°‘ã€‚ç°åœ¨æˆ‘ä»¬ç¨‹åºå‘˜å†™åšå®¢åŸºæœ¬æ˜¯ç”¨ markdown è¯­æ³•äº†ï¼Œåšä¸€ä¸ªåšå®¢çš„è¯ï¼Œä¸å¯ç¼ºå°‘çš„å°±æ˜¯å¯¹ markdown è¯­æ³•çš„è§£æã€‚

- å®‰è£…æ’ä»¶

```
npm install --save gatsby-transformer-remark
```

- åœ¨ gatsby-config.js æ–‡ä»¶é…ç½®

```javascript
module.exports = {
  /* Your site config here */
  siteMetadata: {
    title: `Title from siteMetadata`,
    author: 'jacky',
  },
  plugins: [
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `src`, // åç§°ï¼Œå¯ä»¥ç”¨æ¥è¿‡æ»¤
        path: `${__dirname}/src/`, // æ–‡ä»¶è·¯å¾„
      },
    },
    `gatsby-transformer-remark`,
  ],
}
```

é‡å¯æœåŠ¡

è¿™ä¸ªæ’ä»¶æ·»åŠ äº† allMarkdownRemark å’Œ markdownRemark ä¸¤ä¸ªæ•°æ®å­—æ®µ

![](https://user-gold-cdn.xitu.io/2020/6/21/172d7761605cba2b?w=205&h=243&f=png&s=7538)

- æ–°å»º md æ–‡ä»¶

åœ¨`src`ä¸‹åˆ›å»º`_posts`ç›®å½•ï¼Œæ·»åŠ ä¸€ä¸ª`first-blog.md`æ–‡ä»¶

```
---
title: "æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢"
date: "2020-06-21"
tags: "React"
categories: "Reactç³»åˆ—"
---

## è¿™æ˜¯ç¬¬ä¸€ç¯‡åšå®¢çš„æ ‡é¢˜

first blog çš„å†…å®¹ 1
```

å¦‚æœåšå®¢ä¸æ˜¯è‡ªå·±æ­å»ºçš„ï¼Œè€Œæ˜¯ç›´æ¥ä¸ŠæŸå¹³å°å†™çš„è¯ï¼Œå¯¹ä¸Šé¢è¿™æ®µè¯­æ³•å°±å¯èƒ½ä¸å¤ªäº†è§£ï¼Œåœ¨ md æ–‡ä»¶å¼€å¤´çš„ `---` åŒ…è£¹çš„æ˜¯ frontmatterï¼ˆå‰è¨€ï¼‰ï¼Œç„¶ååœ¨é‡Œé¢å¯ä»¥æ·»åŠ æ–‡ç« çš„å„ç§å…³é”®è¯ä¿¡æ¯ã€‚

ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨`http://localhost:8000/__graphql`æŸ¥è¯¢åˆ°æˆ‘ä»¬å†™çš„ md æ–‡ä»¶çš„è¯¦æƒ…ä¿¡æ¯äº†

![](https://user-gold-cdn.xitu.io/2020/6/21/172d7823d4e7db7f?w=1703&h=499&f=png&s=61510)

æˆ‘ä»¬ç¨å¾®å†æ”¹åŠ¨ï¼Œåˆ›å»ºå¤šä¸¤ä¸ª md æ–‡ä»¶

`second-blog.md`

```
---
title: "æˆ‘çš„ç¬¬äºŒç¯‡åšå®¢"
date: "2020-06-22"
tags: "Vue"
categories: "Vueç³»åˆ—"
---

## è¿™æ˜¯ç¬¬äºŒç¯‡åšå®¢çš„æ ‡é¢˜

second blog çš„å†…å®¹ 2
```

`third-blog.md`

```
---
title: "æˆ‘çš„ç¬¬ä¸‰ç¯‡åšå®¢"
date: "2020-06-23"
tags: "React"
categories: "Reactç³»åˆ—"
---

## è¿™æ˜¯ç¬¬ä¸‰ç¯‡åšå®¢çš„æ ‡é¢˜

third blog çš„å†…å®¹ 3
```

å†æ¬¡æŸ¥è¯¢æ•°æ®ï¼ŒæŠŠæˆ‘ä»¬åˆšåˆšæ·»åŠ çš„æ–‡ç« æ•°æ®éƒ½æ‹¿ä¸‹æ¥äº†

![](https://user-gold-cdn.xitu.io/2020/6/21/172d78dc41c94349?w=599&h=687&f=png&s=41548)

æ—¢ç„¶ GraphQL èƒ½æ‹¿åˆ°æ•°æ®ï¼Œè¯´æ˜æˆ‘ä»¬ä¹Ÿèƒ½æŠŠå®ƒæ”¾åˆ°é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚

æ–°å»ºæ–‡ä»¶`src/pages/blog.js`,æˆ‘ä»¬åšä¸€ä¸ªåšå®¢ç›®å½•æ±‡æ€»ï¼š

```javascript
import React from 'react'
import Layout from '../components/layout'
import { graphql } from 'gatsby'

const Blog = ({ data }) => {
  return (
    <Layout>
      <h1>åšå®¢ç›®å½•</h1>
      <div>
        {data.allMarkdownRemark.edges.map(({ node }) => {
          return (
            <div
              key={node.id}
              style={{
                border: '1px solid #000',
                margin: '10px',
                padding: '10px',
              }}
            >
              <h2>{node.frontmatter.title}</h2>
              <div>åˆ†ç±»{node.frontmatter.categories}</div>
              <div>æ ‡ç­¾ï¼š{node.frontmatter.tags}</div>
              <div>å‘å¸ƒæ—¶é—´ï¼š{node.frontmatter.date}</div>
            </div>
          )
        })}
      </div>
    </Layout>
  )
}

export default Blog

export const query = graphql`
  query {
    allMarkdownRemark {
      edges {
        node {
          id
          frontmatter {
            tags
            title
            date
            categories
          }
        }
      }
    }
  }
`
```

æ‰“å¼€`http://localhost:8000/blog`ï¼Œåšå®¢ç›®å½•å°±å±•ç¤ºå‡ºæ¥äº†ï¼š

![](https://user-gold-cdn.xitu.io/2020/6/23/172e1b12d01e3ba3?w=722&h=601&f=png&s=36586)

ä½†æœ‰ä¸ªé—®é¢˜ï¼Œæ¯ç¯‡åšå®¢çš„ä¿¡æ¯ç¡®å®èƒ½æ‹¿å‡ºæ¥ï¼Œä½†æ˜¯æˆ‘ä»¬è¦é“¾æ¥å•Šï¼Œå³æ˜¯ç‚¹å‡»åšå®¢æ ‡é¢˜ï¼Œè¿›å…¥åšå®¢è¯¦æƒ…é¡µé¢ï¼Œå³æ˜¯æ–‡ç« è·¯å¾„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºé¡µé¢ã€‚

## åˆ©ç”¨æ•°æ®åˆ›å»ºé¡µé¢

### gatsby-node.js

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦å»ºç«‹`gatsby-node.js`æ–‡ä»¶äº†ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢çš„ä»£ç æ˜¯ node å±‚ç›¸å…³çš„ã€‚

å‰é¢æˆ‘ä»¬è¯´è¿‡ `src/pages`ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šå…¨éƒ¨æ¸²æŸ“æˆè·¯ç”±ï¼Œä½†å¦‚æœæˆ‘ä»¬åšå®¢æ–‡ç« ä¸€ç¯‡ç¯‡çš„è¯¦æƒ…é¡µè¦æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ª js æ–‡ä»¶ï¼Œè¿™è‚¯å®šä¸åˆç†äº†ã€‚

æˆ‘ä»¬ä¼šç”¨åˆ°ä¸¤ä¸ª APIï¼š

#### onCreateNode

æ¯å½“åˆ›å»ºæ–°èŠ‚ç‚¹ï¼ˆæˆ–æ›´æ–°ï¼‰æ—¶ï¼ŒGatsby éƒ½ä¼šè°ƒç”¨ onCreateNode å‡½æ•°ã€‚

å‘`gatsby-node.js`å†™å…¥ä»£ç ï¼š

```javascript
exports.onCreateNode = ({ node }) => {
  console.log(node.internal.type)
}
```

é‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹ç»ˆç«¯ï¼Œä½ ä¼šå‘ç°æ‰“å°å‡ºå¾ˆå¤šåˆ›å»ºçš„èŠ‚ç‚¹ï¼š`SitePage`, `SitePlugin`, `Site`, `SiteBuildMetadata`, `Directory`, `File`, `MarkdownRemark`,æˆ‘ä»¬å…³æ³¨çš„åªæœ‰`MarkdownRemark`ï¼Œäºæ˜¯ä¿®æ”¹å‡½æ•°ä½¿å…¶ä»…ä»…è®°å½• MarkdownRemark èŠ‚ç‚¹ï¼›æˆ‘ä»¬ä½¿ç”¨æ¯ä¸€ä¸ª md æ–‡ä»¶çš„åç§°æ¥ä½œä¸ºè·¯å¾„ï¼Œå¦‚è¦è·å–æ–‡ä»¶åç§°ï¼Œä½ éœ€è¦éå†ä¸€éå®ƒçš„çˆ¶èŠ‚ç‚¹ `File`ï¼Œ`File`èŠ‚ç‚¹åŒ…å«äº†æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ•°æ®ã€‚

```javascript
exports.onCreateNode = ({ node, getNode }) => {
  if (node.internal.type === `MarkdownRemark`) {
    const fileNode = getNode(node.parent)
    console.log(`\n`, fileNode.relativePath)
  }
}
```

é‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹ç»ˆç«¯ï¼Œæ‰“å°å¦‚ä¸‹ï¼š

```
 _posts/first-blog.md

 _posts/second-blog.md

 _posts/third-blog.md
```

ç›¸å¯¹è·¯å¾„å‡ºæ¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦åˆ›å»ºè·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨`gatsby-source-filesystem`æ’ä»¶å¸¦çš„åˆ›å»ºè·¯å¾„çš„å‡½æ•°

```javascript
const { createFilePath } = require(`gatsby-source-filesystem`)

exports.onCreateNode = ({ node, getNode }) => {
  if (node.internal.type === `MarkdownRemark`) {
    console.log(createFilePath({ node, getNode, basePath: `pages` }))
  }
}
```

é‡å¯æœåŠ¡ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š

```
/_posts/first-blog/
/_posts/second-blog/
/_posts/third-blog/
```

æ¥ä¸‹æ¥ï¼Œå‘ API ä¼ é€’ä¸€ä¸ªå‡½æ•°`createNodeField`ï¼Œè¯¥å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨å…¶ä»–æ’ä»¶åˆ›å»ºçš„èŠ‚ç‚¹é‡Œåˆ›å»ºå…¶ä»–å­—æ®µã€‚

```javascript
exports.onCreateNode = ({ node, getNode, actions }) => {
  const { createNodeField } = actions
  if (node.internal.type === `MarkdownRemark`) {
    const slug = createFilePath({ node, getNode, basePath: `pages` })
    createNodeField({
      node,
      name: `slug`,
      value: slug, // é€šå¸¸ç”¨ slug ä¸€è¯ä»£è¡¨è·¯å¾„
    })
  }
}
```

é‡å¯æœåŠ¡ï¼Œæ‰“å¼€`http://localhost:8000/__graphql`ï¼Œå°±èƒ½æŸ¥è¯¢åˆ°è·¯å¾„äº†

![](https://user-gold-cdn.xitu.io/2020/6/23/172e1ce4c0a61cae?w=1097&h=448&f=png&s=28484)

#### createPages

createPages è¿™ä¸ª API ç”¨äºæ·»åŠ é¡µé¢ã€‚åœ¨åˆ›å»ºé¡µé¢ä¹‹å‰ï¼Œé¦–å…ˆè¦æœ‰é¡µé¢æ¨¡æ¿ï¼Œè¿™æ ·åˆ›å»ºé¡µé¢å°±èƒ½æŒ‡å®šæ‰€ä½¿ç”¨çš„æ¨¡æ¿äº†ã€‚

æ–°å»ºæ–‡ä»¶`src/templates/blog-post.js`

```javascript
import React from 'react'
import Layout from '../components/layout'

export default () => {
  return (
    <Layout>
      <div>Hello blog post</div>
    </Layout>
  )
}
```

ç„¶åæ›´æ”¹ `gatsby-node.js`çš„`createPages`å‡½æ•°ï¼š

```javascript
const path = require(`path`)

exports.createPages = async ({ graphql, actions }) => {
  const result = await graphql(`
    query {
      allMarkdownRemark {
        edges {
          node {
            fields {
              slug
            }
          }
        }
      }
    }
  `)
  result.data.allMarkdownRemark.edges.forEach(({ node }) => {
    createPage({
      path: node.fields.slug,
      component: path.resolve(`./src/templates/blog-post.js`),
      context: {
        slug: node.fields.slug,
      },
    })
  })
}
```

é‡å¯æœåŠ¡ï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªè·¯å¾„ï¼Œè·³è½¬åˆ°é»˜è®¤çš„ 404 é¡µé¢ï¼Œå°±ä¼šçœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆä¸‰ç¯‡åšå®¢çš„è·¯å¾„äº†ï¼Œç‚¹å‡»ä»»ä¸€ç¯‡ï¼Œè·³è½¬çš„æ˜¯æˆ‘ä»¬åˆšåˆ›å»ºçš„ `blog-post.js`ç»„ä»¶ã€‚

![](https://user-gold-cdn.xitu.io/2020/6/24/172e3bb13a244d4c?w=1230&h=548&f=png&s=51476)

æˆ‘ä»¬è¦çš„æ˜¯æ˜¾ç¤ºåšå®¢å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æ¨¡æ¿æ–‡ä»¶å†è¿›è¡Œæ”¹é€ ï¼š

```javascript
import React from 'react'
import { graphql } from 'gatsby'
import Layout from '../components/layout'

export default ({ data }) => {
  const post = data.markdownRemark
  return (
    <Layout>
      <div>
        <h1>{post.frontmatter.title}</h1>
        <div dangerouslySetInnerHTML={{ __html: post.html }} />
      </div>
    </Layout>
  )
}

export const query = graphql`
  query($slug: String!) {
    markdownRemark(fields: { slug: { eq: $slug } }) {
      html
      frontmatter {
        title
      }
    }
  }
`
```

ä¸Šé¢æ˜¯åŠ¨æ€å˜é‡æŸ¥è¯¢çš„å†™æ³•ï¼ŒGraphQL çš„è¯­æ³•ï¼Œå¯ä»¥çœ‹çœ‹ (https://graphql.org/learn/queries/#variables)

å®Œæˆä¹‹åï¼Œæ¯”å¦‚æˆ‘ç‚¹å‡»ç¬¬äºŒç¯‡åšå®¢ï¼Œå°±å¯ä»¥æ­£ç¡®è¿›å…¥é¡µé¢å¹¶æ˜¾ç¤ºå†…å®¹äº†

![](https://user-gold-cdn.xitu.io/2020/6/24/172e3c8f759609dd?w=757&h=255&f=png&s=18207)

ä¸ºäº†æ›´å®Œå–„ï¼Œæˆ‘ä»¬ç»™ blog ç›®å½•é¡µé¢æ·»åŠ å¯è·³è½¬çš„é“¾æ¥ï¼ŒåŠ å…¥ `slug`æŸ¥è¯¢å­—æ®µ, å¢åŠ  `Link`è·³è½¬ï¼Œè¿™ä¸ªç”¨æ³•ä¸ React è·¯ç”±çš„ `Link`å·®ä¸å¤šä¸€è‡´ï¼Œæ¶‰åŠä¸æ·±çš„æƒ…å†µä¸‹æš‚ä¸”å½“æˆç›¸åŒç”¨æ³•ã€‚

`src/pages/blog.js`

```javascript
import React from 'react'
import Layout from '../components/layout'
import { graphql, Link } from 'gatsby'

const Blog = ({ data }) => {
  return (
    <Layout>
      <h1>åšå®¢ç›®å½•</h1>
      <div>
        {data.allMarkdownRemark.edges.map(({ node }) => {
          return (
            <Link to={node.fields.slug} key={node.id}>
              <div
                style={{
                  border: '1px solid #000',
                  margin: '10px',
                  padding: '10px',
                }}
              >
                <h2>{node.frontmatter.title}</h2>
                <div>åˆ†ç±»{node.frontmatter.categories}</div>
                <div>æ ‡ç­¾ï¼š{node.frontmatter.tags}</div>
                <div>å‘å¸ƒæ—¶é—´ï¼š{node.frontmatter.date}</div>
              </div>
            </Link>
          )
        })}
      </div>
    </Layout>
  )
}

export default Blog

export const query = graphql`
  query {
    allMarkdownRemark {
      edges {
        node {
          id
          frontmatter {
            tags
            title
            date
            categories
          }
          fields {
            slug
          }
        }
      }
    }
  }
`
```

![](https://user-gold-cdn.xitu.io/2020/6/24/172e3ce7be50852c?w=722&h=596&f=png&s=36793)

ç°åœ¨ç‚¹å‡»åšå®¢ï¼Œå°±èƒ½è·³è½¬åˆ°å¯¹åº”é¡µé¢äº†ï¼Œè™½ç„¶æ²¡åšæ ·å¼é¡µé¢æ¯”è¾ƒä¸‘ï¼Œä½†åªè¦åœ¨`src/_posts`ç›®å½•æ–°å»º md æ–‡ä»¶ï¼Œç„¶åè¿™é‡Œå°±èƒ½è·Ÿç€è‡ªåŠ¨åˆ·æ–°ï¼Œç®—æ˜¯ä¸€ä¸ªè¶…ç®€æ˜“çš„åšå®¢äº†ã€‚

## æ‰“åŒ…ä¸Šçº¿

åœæ­¢å¼€å‘æœåŠ¡ï¼Œæ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼ŒæŠŠé™æ€æ–‡ä»¶è¾“å‡ºåˆ° public ç›®å½•ä¸­

```
gatsby build
```

åœ¨æœ¬åœ°æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬ï¼Œè¿è¡Œï¼š

```
gatsby serve
```

æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥åœ¨`localhost:9000`è®¿é—®æˆ‘ä»¬åˆšæ‰åšçš„ç½‘ç«™äº†

æœ¬é¡¹ç›®çš„ [github åœ°å€](https://github.com/Jacky-Summer/gatsby-blog-demo)

è‡³æ­¤ï¼Œæˆ‘ä»¬æ•™ç¨‹å°±ä»‹ç»åˆ°è¿™é‡Œäº†ã€‚

<br>

- psï¼š [ä¸ªäººæŠ€æœ¯åšæ–‡ Github ä»“åº“](https://github.com/Jacky-Summer/personal-blog)ï¼Œè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿ starï¼Œç»™æˆ‘ä¸€ç‚¹é¼“åŠ±ç»§ç»­å†™ä½œå§~
